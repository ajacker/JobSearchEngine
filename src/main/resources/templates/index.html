<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>职位搜索</title>
    <style>
        dl,
        dd {
            margin: 0;
        }

        #box {
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 10px rgba(73,66,66,.1);
            margin: 25px auto;
            border: 1px solid #E5E5E5;
        }

        #box dl {
            height: 50px;
            line-height: 50px;
            border-bottom: 1px dashed #dadada;
            margin: 0 30px;
        }

        #box dt {
            float: left;
            margin-top: 14px;
            color: #8a8a8a;
        }

        #box dd {
            float: left;
            color: #252525;
            margin-top: 14px;
            margin-left: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        #box dd.active {
            color: #66ccff;
            font-weight: bold;
        }

        #box dl.select {
            background: #efefef;
            margin: 0;
            padding: 0 30px;
        }

        #box dl.select dd{
            border: 1px solid #66ccff;
            height: 25px;
            line-height: 25px;
            margin-top: 13px;
            padding: 0 2px 0 10px;
            border-radius: 3px;background-color: #fff;
        }
        #box dl.select dd span{
            width: 20px;
            height: 20px;
            display: inline-block;
            text-align: center;
            line-height: 20px;
            background: #66ccff;
            color: #fff;
            margin-left: 10px;
            cursor: pointer;border-radius: 5px;
        }
    </style>
    <!-- Bootstrap -->
    <link href="webjars/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">

    <!-- Latest compiled and minified CSS -->
    <link href="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.css" rel="stylesheet">
</head>
<body class="container">

    <div class="row">
        <!--导航条-->
        <nav class="navbar navbar-default col-1" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">职业查询</a>
                </div>
            </div>
        </nav>
    </div>


    <div class="row" >
        <form class="col-1 form-inline">
            <div class="container-fluid">
                <div class="row">
                    <div class="form-group col-md-8">
                        <label for="inputKeyWord">全文检索：</label>
                        <input type="text" class="form-control" id="inputKeyWord" placeholder="搜索全文/职位名">

                    </div>
                    <div class="form-group col-md-4">
                        <label for="selectorPlace">省份：</label>
                        <select class="selectpicker" id="selectorPlace" data-live-search="true">
                            <option value="全国">全国</option>
                            <option value="山东">山东</option>
                            <option value="江苏">江苏</option>
                            <option value="上海">上海</option>
                            <option value="浙江">浙江</option>
                            <option value="安徽">安徽</option>
                            <option value="福建">福建</option>
                            <option value="江西">江西</option>
                            <option value="广东">广东</option>
                            <option value="广西">广西</option>
                            <option value="海南">海南</option>
                            <option value="河南">河南</option>
                            <option value="湖南">湖南</option>
                            <option value="湖北">湖北</option>
                            <option value="北京">北京</option>
                            <option value="天津">天津</option>
                            <option value="河北">河北</option>
                            <option value="山西">山西</option>
                            <option value="内蒙古">内蒙古</option>
                            <option value="宁夏">宁夏</option>
                            <option value="青海">青海</option>
                            <option value="陕西">陕西</option>
                            <option value="甘肃">甘肃</option>
                            <option value="新疆">新疆</option>
                            <option value="四川">四川</option>
                            <option value="贵州">贵州</option>
                            <option value="云南">云南</option>
                            <option value="重庆">重庆</option>
                            <option value="西藏">西藏</option>
                            <option value="辽宁">辽宁</option>
                            <option value="吉林">吉林</option>
                            <option value="黑龙江">黑龙江</option>
                            <option value="香港">香港</option>
                            <option value="澳门">澳门</option>
                            <option value="台湾">台湾</option>
                        </select>
                        <button id="searchBtn" type="button" class="btn btn-primary" onclick="search()">搜索</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="row">
        <div id="box" class="col-1">
            <dl class="row" id="salaryRange">
                <dt>月薪范围：</dt>
                <dd data="0-2">2千以下</dd>
                <dd data="2-3">2-3千</dd>
                <dd data="3-4.5">3-4.5千</dd>
                <dd data="4.5-6">4.5-6千</dd>
                <dd data="6-8">6-8千</dd>
                <dd data="8-10">0.8-1万</dd>
                <dd data="10-15">1-1.5万</dd>
                <dd data="15-20">1.5-2万</dd>
                <dd data="20-30">2-3万</dd>
                <dd data="30-40">3-4万</dd>
                <dd data="40-50">4-5万</dd>
                <dd data="50-1000">5万以上</dd>
            </dl>
            <dl class="row" id="timeRange">
                <dt>发布日期：</dt>
                <dd data="1">今天</dd>
                <dd data="3">近三天</dd>
                <dd data="7">近一周</dd>
                <dd data="30">近一月</dd>
            </dl>
            <dl class="row" id="educationRange">
                <dt>学历要求：</dt>
                <dd data="1">初中及以下</dd>
                <dd data="2">高中/中技/中专</dd>
                <dd data="3">大专</dd>
                <dd data="4">本科</dd>
                <dd data="5">硕士</dd>
                <dd data="6">博士</dd>
            </dl>
            <dl class="row" id="expRange" style="border: none">
                <dt>工作经验：</dt>
                <dd data="0-100">无经验</dd>
                <dd data="1-3">1-3年</dd>
                <dd data="3-5">3-5年</dd>
                <dd data="5-10">5-10年</dd>
                <dd data="10">10年以上</dd>
            </dl>
            <dl class="select row" style="border-bottom-width: 0;">
                <dt>已选条件：</dt>

            </dl>
        </div>
    </div>
    <!--显示结果的面板-->
    <div class="row panel panel-default">
        <!-- Default panel contents -->
        <div class="panel-heading" style="text-align: center">查询结果</div>

        <table id="table"></table>

    </div>
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="webjars/jquery/3.4.1/jquery.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="webjars/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="js/bootstrap-select.js"></script>

<!-- (Optional) Latest compiled and minified JavaScript translation files -->
<script src="js/i18n/defaults-zh_CN.js"></script>


    <!-- Latest compiled and minified JavaScript -->
    <script src="js/bootstrap-table.min.js"></script>
    <!-- Latest compiled and minified Locales -->
    <script src="js/i18n/bootstrap-table-zh-CN.min.js"></script>
<script>
    function search() {
        // var keyword = $('#inputKeyWord').val();
        // var salary = $('#salaryRange > .active').attr("data");
        // if(salary==null){
        //     salary="*-*";
        // }
        // var time = $('#timeRange > .active').attr("data");
        // var education = $('#educationRange > .active').attr("data");
        // var exp = $('#expRange > .active').attr("data");
        // var place = $('#selectorPlace').val();
        //
        // console.log(salary);
        // $.ajax({
        //     type:"POST",
        //     url:"/search",
        //     data:{
        //         keyword:keyword,
        //         salary:salary,
        //         time:time,
        //         education:education,
        //         exp:exp,
        //         place:place
        //     },
        //     dataType:"json",
        //     success:function (data) {
        //         alert(data);
        //     }
        // });
        $("#table").bootstrapTable('refresh', {pageNumber: 1});

    }
</script>
    <script>
        $(document).ready(function () {
            $('#table').bootstrapTable({
                url: '/search',
                method: 'post',
                queryParamsType: '',
                queryParams: getParams,
                pagination: true,
                pageNumber: 1,
                pageSize: 30,
                pageList: [15, 30, 50, 100],
                sidePagination: 'server',
                paginationPreText: '上一页',
                paginationNextText: '下一页',
                columns: [
                    {
                        title: "职位名",
                        field: 'jobName',
                        formatter: function (value, row, index) {
                            var actions = [];
                            actions.push('<a href=' + row.url + '>' + value + '</a> ');
                            return actions.join('');
                        }
                    },
                    {title: "公司名", field: 'companyName'},
                    {title: "工作地点", field: 'jobAddr'},
                    {title: "薪资", field: 'salary'},
                    {title: "发布时间", field: 'time'},
                    {title: "链接", field: 'url', visible: false}
                ]


            })
        });

        function getParams(params) {
            var keyword = $('#inputKeyWord').val();
            var salary = $('#salaryRange > .active').attr("data");
            var time = $('#timeRange > .active').attr("data");
            var education = $('#educationRange > .active').attr("data");
            var exp = $('#expRange > .active').attr("data");
            var place = $('#selectorPlace').val();
            return {
                pageNumber: params.pageNumber,
                pageSize: params.pageSize,
                sortName: params.sortName,
                sortOrder: params.sortOrder,
                keyword: keyword,
                salary: salary,
                time: time,
                education: education,
                exp: exp,
                place: place
            };
        }
    </script>
<script>


        var dls = document.querySelectorAll('dl:not(.select)');
        var selected=document.querySelector('.select');

        for (var i = 0; i < dls.length; i++) {
            dls[i].mark=false;	//给每一行的dl标签添加一条属性，用于对应下面的dd标签。我们约定如果这个属性的值为true表示对应的标签没有创建。如果值为false表示对应的标签已经创建了
            select(i);
        }

        function select(n) {
            var dds = dls[n].querySelectorAll('dd');
            var prev=null;
            var dd=null;	//每一行都需要创建一个dd标签，放到这里是为了如果标签已经被创建了，通过这个变量能够找到这个标签

            for (var i = 0; i < dds.length; i++) {
                dds[i].onclick = function () {
                    //给当前点击的添加一个高亮
                    //prev && (prev.className = '');
                    if(prev){
                        prev.className = ''
                    }
                    this.className = 'active';
                    prev = this;
                    //创建dd标签
                    var parent=this.parentNode;
                    if(!parent.mark){	//这个条件满足说明对应的dd标签还没有创建
                        dd=document.createElement('dd');
                        dd.innerHTML=this.innerHTML;
                        selected.appendChild(dd);
                        parent.mark=true;
                    }else{
                        //走这里的时候说明对应的标签已经创建了，只需要把内容修改了就可以了
                        dd.innerHTML=this.innerHTML;
                    }
                    var span=document.createElement('span');
                    var This=this;
                    span.innerHTML='x';
                    span.onclick=function(){
                        //alert(1);
                        /*
                            点击关闭后要做的事情
                                1、移除掉dd
                                2、把上面点击的那个class去掉
                                3、父级身上的mark属性要更新
                         */
                        selected.removeChild(dd);
                        This.className='';
                        parent.mark=false;
                    };
                    dd.appendChild(span);
                };
            }
        }
    </script>
</body>
</html>