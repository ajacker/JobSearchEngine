<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>爬虫管理控制台</title>
    <!-- Bootstrap -->
    <link href="webjars/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Latest compiled and minified CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css"
          rel="stylesheet">
    <!-- Latest compiled and minified CSS -->
    <link href="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <div class="page-header row">
        <h1>爬虫管理系统<small>信息监控+状态管理</small></h1>
        <h3>当前状态：
            <span aria-hidden="true" class="glyphicon glyphicon-asterisk" id="status-span" style="color: green"></span>
        </h3>
    </div>
    <table class="table table-condensed row">
        <thead>
        <tr>
            <th>队列剩余数量</th>
            <th>下载成功数量</th>
            <th>下载失败数量</th>
            <th>下载成功率</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td id="leftCount">获取中...</td>
            <td id="downloadSuccess">获取中...</td>
            <td id="downloadError">获取中...</td>
            <td id="downloadSuccessRate">获取中...</td>
        </tr>
        </tbody>
        <thead>
        <tr>
            <th>总页数</th>
            <th>分析成功数量</th>
            <th>分析失败数量</th>
            <th>分析成功率</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td id="totalPage">获取中...</td>
            <td id="analyseSuccess">获取中...</td>
            <td id="analyseError">获取中...</td>
            <td id="analyseSuccessRate">获取中...</td>
        </tr>
        </tbody>
    </table>
    <div class="row" style="display: flex">
        <div aria-label="..." class="btn-group btn-group-lg center-block" role="group">
            <button class="btn btn-success" id="start-btn" onclick="start()" type="button">
                <span aria-hidden="true" class="glyphicon glyphicon-play"></span>
                启动
            </button>
            <button class="btn btn-danger" id="stop-btn" onclick="stop()" type="button">
                <span aria-hidden="true" class="glyphicon glyphicon-stop"></span>
                停止
            </button>
        </div>
    </div>

    <div class="panel panel-primary row" style="margin-top: 20px">
        <div class="panel-heading">
            <h3 class="panel-title">信息：</h3>
        </div>
        <div class="panel-body">
            <div id="message"></div>
        </div>
    </div>
</div>

</body>
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="webjars/jquery/3.4.1/jquery.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="webjars/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="js/bootstrap-select.js"></script>

<!-- (Optional) Latest compiled and minified JavaScript translation files -->
<script src="js/i18n/defaults-zh_CN.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="js/bootstrap-table.min.js"></script>
<!-- Latest compiled and minified Locales -->
<script src="js/i18n/bootstrap-table-zh-CN.min.js"></script>
<script>
    $(function () {
        window.setInterval(function () {
            $.ajax({
                type: "POST",
                url: "/info",
                success: function (data) {
                    $('#downloadSuccess').html(data.downloadSuccess);
                    $('#downloadError').html(data.downloadError);
                    $('#leftCount').html(data.leftPage);
                    $('#downloadSuccessRate').html(data.downloadSuccessRate);
                    $('#totalPage').html(data.totalPage);
                    $('#analyseError').html(data.analyseError);
                    $('#analyseSuccess').html(data.analyseSuccess);
                    $('#analyseSuccessRate').html(data.analyseSuccessRate);
                    var info = $('#status-span');
                    switch (data.status) {
                        case 'Running':
                            info.css('color', 'green');
                            info.text('\t运行中');
                            break;
                        case 'Stopped':
                            info.css('color', 'red');
                            info.text('\t已停止');
                            break;
                    }

                }
            });
        }, 1000);
    });

    function start() {
        $.ajax({
            type: "POST",
            url: "/start",
            success: onReturn
        });
    }

    function stop() {
        $.ajax({
            type: "POST",
            url: "/stop",
            success: onReturn
        });
    }

    function onReturn(data) {
        var status = data.status;
        var message = data.message;
        var type;
        switch (status) {
            case "-1":
                type = "alert alert-danger alert-dismissible";
                break;
            case "0":
                type = "alert alert-warning alert-dismissible";
                break;
            case "1":
                type = "alert alert-success alert-dismissible";
                break;
        }
        $("#message").prepend('<div class="' + type + '" role="alert">' +
            '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
            + message + '</div>')
    }
</script>
</html>